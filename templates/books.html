<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Archive - Books</title>
    <style>
        /* BASE STYLES from uploaded file */
        body {
            font-family: serif;
            margin: 20px;
            line-height: 1.6; /* Improved readability */
            color: #000; /* Ensure all body text is black */
            overflow-x: hidden; /* Prevent horizontal scroll */
            background-color: #fff; /* Ensure white background */
        }

        /* Prevent horizontal scroll globally */
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Hide scrollbars but keep functionality */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        *::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }

        /* Style for centering the content column */
        .content-wrapper {
            max-width: 600px; /* Sets a readable maximum width for the column */
            margin: 0 auto; /* Centers the div horizontally */
            width: 100%; /* Ensures it uses available space up to max-width */
            box-sizing: border-box; /* Include padding in width calculation */
            padding-top: 10px;
        }

        /* Layout for the Header: Sticker and Navigation on one line */
        .header-container {
            display: flex;
            align-items: center; /* Vertically centers the nav and sticker */
            gap: 20px; /* Space between sticker and nav */
            margin-bottom: 40px; /* Increased space below the header for better separation */
        }

        /* Ensure navigation links appear next to each other and remove underline */
        nav {
            display: flex;
            gap: 15px; 
            /* Push the navigation to the far right */
            margin-left: auto;
        }
        
        /* Custom underline styling */
        nav a {
            text-decoration: none; /* Remove default underline */
            color: initial; /* Default link color (same as body text) */
            transition: color 0.1s;
        }
        
        /* Apply wavy underline, inheriting the dynamic color */
        nav a:hover {
            color: var(--date-color); /* Change text color to dynamic color */
            text-decoration: underline wavy; 
            text-decoration-color: var(--date-color); /* Change underline color to dynamic color */
            text-underline-offset: 4px; /* Slight offset for readability */
            cursor: pointer;
        }

        /* Styling for the sticker (Static - no transitions/animations) */
        .pixel-sticker {
            display: block;
            transform-origin: center; /* Ensures rotation is around the sticker's center */
        }
        
        /* --- BOOK GRID DASHBOARD STYLES --- */

        .book-grid {
            display: grid;
            /* Adjusted minmax to allow for 5-6 columns */
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 1px; /* Minimal space between covers */
            margin-top: 10px;
            padding: 0;
            list-style: none;
            /* Enable 3D perspective on the parent container */
            perspective: 1000px; 
        }

        .book-cover {
            display: block;
            position: relative;
            /* Removed background color, now using background-image */
            background-size: cover; /* Ensures image covers the full area */
            background-position: center; /* Centers the image */
            background-repeat: no-repeat;
            overflow: hidden;
            /* Aspect Ratio Hack (2:3 for a standard novel size) */
            width: 100%;
            padding-bottom: 150%; /* 150% of width = 2/3 height */
            cursor: pointer;
            /* Set a fast transition for the initial hover effect */
            transition: transform 0.1s ease-out, box-shadow 0.2s; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); /* Darker shadow for image contrast */
            /* Preserve 3D space for rotations */
            transform-style: preserve-3d;
            /* Set initial transform for a smoother transition */
            transform: perspective(600px) rotateX(0deg) rotateY(0deg); 
        }

        .book-cover:hover {
            /* JS will handle the actual transform */
            z-index: 10;
            box-shadow: 0 8px 15px rgba(0,0,0,0.4); /* Enhanced shadow on hover */
        }


        /* Mobile Responsive Styles */
        @media screen and (max-width: 768px) {
            body {
                margin: 10px;
                padding: 0;
            }

            .content-wrapper {
                max-width: 100%;
                width: calc(100vw - 25px);
                padding: 0;
                margin: 0 auto;
                box-sizing: border-box;
            }

            .header-container {
                margin-bottom: 25px;
                gap: 15px;
            }
            
            /* Responsive Grid Adjustments: 4 columns */
            .book-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Extra small screens (phones in portrait) */
        @media screen and (max-width: 480px) {
            body {
                margin: 5px;
                padding: 0;
            }

            .content-wrapper {
                width: calc(100vw - 20px);
            }

            .header-container {
                margin-bottom: 20px;
                gap: 10px;
            }

            nav {
                gap: 8px;
                flex-wrap: wrap;
            }
            
            /* Maintaining 4 columns for max density */
            .book-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-gap: 1px;
            }
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <header class="header-container">
            <!-- 
                2D Sticker container. Reduced size to 32x32 for pixelated look.
                The content is a procedural geometric figure dynamically inserted by JavaScript.
            -->
            <svg id="random-sticker-svg" class="pixel-sticker" width="32" height="32" viewBox="0 0 4 4">
                <!-- Fallback content, overwritten by JS -->
            </svg>

            <!-- Navigation (moved to the far right) -->
            <nav>
                <a href="/">home</a>
                <a href="/work">work</a>
                <a href="/books">books</a>
                <a href="/contact">contact</a>
            </nav>
        </header>

        <!-- Book Dashboard Content -->
        <div class="book-dashboard-content">
            <div class="book-grid" id="book-grid">
                <!-- Book Covers will be dynamically inserted here by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // --- BOOK DATA JSON TEMPLATE ---
        // Server-rendered book data from Flask
        const bookData = {{ books|tojson }};
        // --- END BOOK DATA JSON TEMPLATE ---


        // Global variable to store the calculated primary color
        let stickerFigureColor = '';

        // --- Color Generation Utilities (Updated for Triadic Colors) ---
        function hslToHex(h, s, l) {
            s /= 100;
            l /= 100;
            const k = n => (n + h / 30) % 12;
            const a = s * Math.min(l, 1 - l);
            const f = n =>
                l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));
            const toHex = val => Math.round(255 * val).toString(16).padStart(2, '0');
            return `#${toHex(f(0))}${toHex(f(8))}${toHex(f(4))}`;
        }

        /**
         * Generates three bold, bright colors forming a Triadic Color Scheme.
         * Returns an array [C1, C2, C3]. C3 is used for the primary highlight color.
         */
        function generateBoldTriadicColors() {
            const H1 = Math.floor(Math.random() * 360);
            const S = Math.floor(Math.random() * 20) + 80; // 80-100% Saturation (Bold)
            const L = Math.floor(Math.random() * 10) + 55; // 55-65% Lightness (Bright)

            const C1 = hslToHex(H1, S, L);
            const H2 = (H1 + 120) % 360;
            const C2 = hslToHex(H2, S, L);
            const H3 = (H1 + 240) % 360; // Third color in the triad, used for highlight
            const C3 = hslToHex(H3, S, L);

            return [C1, C2, C3];
        }
        
        // --- Sticker Generation Logic ---
        function getRandomFigure() {
            const colors = generateBoldTriadicColors();
            // Randomly select two colors for the sticker (C_A and C_B)
            const indexA = Math.floor(Math.random() * 3);
            let indexB = (indexA + 1) % 3; 
            if (Math.random() < 0.5) indexB = (indexA + 2) % 3;

            const stickerColors = [colors[indexA], colors[indexB]];
            
            // C3 is now the dedicated highlight color for the nav hover
            const highlightColor = colors[2]; 

            const P1 = stickerColors[0];
            const P2 = stickerColors[1];
            
            stickerFigureColor = highlightColor; // Set the C3 color globally for CSS variable

            const patternTypes = [
                () => `<polygon points="0,0 4,4 4,0" fill="${P1}" /><polygon points="0,0 4,4 0,4" fill="${P2}" />`,
                () => `<rect x="0" y="0" width="2" height="2" fill="${P1}" /><rect x="2" y="0" width="2" height="2" fill="${P2}" /><rect x="0" y="2" width="2" height="2" fill="${P2}" /><rect x="2" y="2" width="2" height="2" fill="${P1}" />`,
                () => `<rect x="0" y="0" width="2" height="4" fill="${P1}" /><rect x="2" y="0" width="2" height="4" fill="${P2}" />`,
                () => `<rect x="0" y="0" width="4" height="4" fill="${P1}" />`,
                () => `<circle cx="2" cy="2" r="2" fill="${P1}" />`,
                () => `<polygon points="2,0 4,4 0,4" fill="${P1}" />`,
                () => {
                    const innerShapes = [`<rect x="1" y="1" width="2" height="2" fill="${P2}" />`, `<circle cx="2" cy="2" r="1" fill="${P2}" />`, `<polygon points="2,1 3.5,3.5 0.5,3.5" fill="${P2}" />`];
                    return `<rect x="0" y="0" width="4" height="4" fill="${P1}" />${innerShapes[Math.floor(Math.random() * innerShapes.length)]}`;
                }
            ];
            return patternTypes[Math.floor(Math.random() * patternTypes.length)]();
        }

        function randomizeSticker(randomizeFigure = true) {
            const svgContainer = document.getElementById('random-sticker-svg');
            
            if (randomizeFigure) {
                // 1. Generate the complex randomized figure SVG
                svgContainer.innerHTML = getRandomFigure();

                // 2. Randomize Orientation (0, 90, 180, 270 degrees)
                const orientations = [0, 90, 180, 270];
                const randomRotation = orientations[Math.floor(Math.random() * orientations.length)];
                svgContainer.style.transform = `rotate(${randomRotation}deg)`;
            }

            // Set CSS Variable for use in the dynamic underline on hover
            document.documentElement.style.setProperty('--date-color', stickerFigureColor);
            
            // Optional: Color the book covers slightly with the highlight color
            const covers = document.querySelectorAll('.book-cover');
            covers.forEach((cover) => {
                // Ensure the transform transition is set quickly for mousemove
                cover.style.transition = 'transform 0.1s ease-out, box-shadow 0.2s';
            });
        }

        // --- Dynamic Content Rendering ---
        function renderBookGrid() {
            const gridContainer = document.getElementById('book-grid');
            if (!gridContainer) return;

            let html = '';
            bookData.forEach(book => {
                // The title is now only provided via the `title` attribute for tooltips and accessibility.
                
                html += `
                    <a 
                        href="/book/${book.slug}" 
                        class="book-cover" 
                        title="${book.title} by ${book.author}" 
                        data-id="${book.id}"
                        style="background-image: url('${book.imageUrl}');"
                    >
                        <!-- Title element removed per user request for absolute minimalism -->
                    </a>
                `;
            });

            gridContainer.innerHTML = html;
        }


        // --- Parallax Hover Effect Logic ---
        function initParallaxEffect() {
            const bookCovers = document.querySelectorAll('.book-cover');
            const maxRotation = 5; // Max tilt in degrees
            const perspectiveValue = 600; // Perspective value for the 3D effect

            bookCovers.forEach(cover => {
                // Function to handle the mouse movement
                function handleMouseMove(e) {
                    const rect = cover.getBoundingClientRect();
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;

                    // Calculate mouse position relative to the center
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;

                    // Normalize position from -1 to 1
                    // Max value of 1 when mouse is at the edge
                    const normalizedX = (mouseX - centerX) / centerX;
                    const normalizedY = (mouseY - centerY) / centerY;

                    // Calculate rotation angles
                    // rotateY is controlled by X position (move right = tilt right)
                    const rotateY = normalizedX * maxRotation; 
                    // rotateX is controlled by Y position (move up = tilt down, hence negative)
                    const rotateX = normalizedY * -maxRotation; 

                    // Apply the 3D transform, including a slight scale and translateZ for pop-out
                    cover.style.transform = `
                        perspective(${perspectiveValue}px) 
                        rotateX(${rotateX}deg) 
                        rotateY(${rotateY}deg) 
                        translateZ(10px) 
                        scale(1.02)
                    `;
                }

                // Function to reset the cover when mouse leaves
                function handleMouseLeave() {
                    // Temporarily set a slower transition for the smooth return
                    cover.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s';
                    
                    // Reset the transformation
                    cover.style.transform = 'perspective(600px) rotateX(0deg) rotateY(0deg) translateZ(0) scale(1)';
                    
                    // Re-apply the quick transition after reset duration to ensure smooth movement on next hover
                    setTimeout(() => {
                        cover.style.transition = 'transform 0.1s ease-out, box-shadow 0.2s';
                    }, 500);
                }

                // Add event listeners
                cover.addEventListener('mousemove', handleMouseMove);
                cover.addEventListener('mouseleave', handleMouseLeave);
            });
        }


        // Initialization function
        window.onload = function() {
            renderBookGrid(); // 1. Render content first
            randomizeSticker(true); // 2. Initial sticker randomization and color setting
            initParallaxEffect(); // 3. Initialize the 3D hover effect on the newly created elements
        };
    </script>
</body>
</html>
